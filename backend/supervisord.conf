; supervisord.conf
; RQ Worker 进程管理配置
;
; 使用方式:
;   supervisord -c supervisord.conf          # 启动 supervisor 守护进程
;   supervisorctl -c supervisord.conf status # 查看状态
;   supervisorctl -c supervisord.conf start rq-worker
;   supervisorctl -c supervisord.conf stop rq-worker
;   supervisorctl -c supervisord.conf restart rq-worker
;   supervisorctl -c supervisord.conf tail -f rq-worker  # 查看日志

[supervisord]
logfile = logs/supervisord.log
logfile_maxbytes = 50MB
logfile_backups = 10
loglevel = info
pidfile = logs/supervisord.pid
nodaemon = false
directory = %(here)s

[unix_http_server]
file = logs/supervisor.sock

[supervisorctl]
serverurl = unix://logs/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

; ========================================
; RQ Worker 进程
; ========================================
[program:rq-worker]
command = %(here)s/.venv/bin/python worker.py
directory = %(here)s
autostart = true
autorestart = true
startsecs = 5
startretries = 3
stopwaitsecs = 600
stopsignal = TERM
user = %(ENV_USER)s
stdout_logfile = logs/rq-worker.log
stdout_logfile_maxbytes = 50MB
stdout_logfile_backups = 5
redirect_stderr = true
environment = PYTHONUNBUFFERED="1"